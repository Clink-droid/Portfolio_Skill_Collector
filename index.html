<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cyber Skill Collector</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #0e0e0e;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #1a1a1a;
      border: none; /* remove existing border as it's handled by container */
      width: 100%;
      height: 100%;
      border-radius: 8px;
    }
    #tooltip {
      position: absolute;
      color: #00ffcc;
      background: rgba(0, 0, 0, 0.85);
      border: 1px solid #00ffcc;
      padding: 4px 8px;
      border-radius: 4px;
      display: none;
      pointer-events: none;
      font-size: 12px;
    }
    #muteButton {
      position: absolute;
      top: 10px;
      right: 10px;
      color: #00ffcc;
      background: #111;
      border: 1px solid #00ffcc;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
    }
    /* New styles for start button and rules overlay */
    #startButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #00ffcc;
      color: #0e0e0e;
      border: none;
      border-radius: 8px;
      padding: 16px 32px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px #00ffcc;
      z-index: 10;
      display: none;
    }
    #rulesOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(14, 14, 14, 0.95);
      border: 2px solid #00ffcc;
      border-radius: 12px;
      padding: 24px 32px;
      width: 320px;
      color: #00ffcc;
      font-size: 16px;
      line-height: 1.4;
      z-index: 20;
      display: none;
      text-align: center;
      user-select: none;
    }
    #rulesOverlay h2 {
      margin-top: 0;
      font-size: 22px;
      margin-bottom: 12px;
    }
    #rulesOverlay ul {
      text-align: left;
      padding-left: 20px;
      margin-bottom: 12px;
    }
    #rulesOverlay .malware-icons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 12px;
    }
    #rulesOverlay .malware-icons img {
      width: 48px;
      height: 48px;
      filter: drop-shadow(0 0 2px #ff0000);
    }
    #countdownTimer {
      font-size: 20px;
      font-weight: bold;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="tooltip"></div>
  <button id="muteButton">üîà Mute</button>

  <!-- New Start Game button -->
  <button id="startButton">Start Game</button>

  <!-- New Rules Overlay -->
  <div id="rulesOverlay">
    <h2>Game Rules</h2>
    <p><strong>Objective:</strong> Collect as many cybersecurity skills as possible.</p>
    <p><strong>Avoid</strong> malware icons ‚Äî collecting them ends the game.</p>
    <p>You can only move left and right using <strong>Arrow keys</strong> or <strong>A/D</strong> keys.</p>
    <h3>üõ°Ô∏è Skills to Collect:</h3>
    <ul>
      <li>Represented by tool icons (e.g., Wireshark, Nmap, Burp Suite, etc.).</li>
      <li>These help increase your score.</li>
    </ul>
    <h3>‚ò†Ô∏è Malware to Avoid:</h3>
    <div class="malware-icons">
      <img src="https://cdn.vectorstock.com/i/1000x1000/77/65/virus-infection-bug-icon-vector-12867765.webp" alt="Malware1" />
      <img src="https://cdn3.iconfinder.com/data/icons/science-flat-round/512/bug_insect_ladybird_animal_virus_error_add-512.png" alt="Malware2" />
    </div>
    <div id="countdownTimer">Starting in 10...</div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Responsive canvas resizing
    let width = canvas.width;
    let height = canvas.height;
    function resizeCanvas() {
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
      width = canvas.width;
      height = canvas.height;
    }
    window.addEventListener('load', resizeCanvas);
    window.addEventListener('resize', resizeCanvas);

    const tooltip = document.getElementById('tooltip');
    const muteButton = document.getElementById('muteButton');
    const startButton = document.getElementById('startButton');
    const rulesOverlay = document.getElementById('rulesOverlay');
    const countdownTimer = document.getElementById('countdownTimer');

    // Initialize and use width and height after resizing

    let isMuted = false;
    let infected = false; // Flag to track if player collected malware

    // Updated skillIcons array to include image URLs and placeholders for Image objects
    const skillIcons = [
      { name: 'Wireshark', desc: 'Packet analysis tool.', color: '#00ffff', url: 'https://upload.wikimedia.org/wikipedia/commons/d/db/Wireshark_Icon.png', img: null },
      { name: 'Nmap', desc: 'Network discovery scanner.', color: '#ffcc00', url: 'https://nmap.org/images/sitelogo-2x.png', img: null },
      { name: 'Nessus', desc: 'Vulnerability assessment.', color: '#ff6699', url: 'http://www.linuxfocus.org/common/images/article217/illustration217.png', img: null },
      { name: 'Splunk', desc: 'SIEM log analyzer.', color: '#ff9900', url: 'https://logos-world.net/wp-content/uploads/2022/11/Splunk-Logo-500x281.png', img: null },
      { name: 'Burp Suite', desc: 'Web vulnerability scanner.', color: '#ff3300', url: 'https://cdn4.iconfinder.com/data/icons/macaron-1/48/BurpSuite-512.png', img: null },
      { name: 'OWASP ZAP', desc: 'Web app security tester.', color: '#66ff66', url: 'https://www.lancork.net/wordpress/wp-content/uploads/2014/06/owasp-zap-logo.png', img: null },
      { name: 'Snyk', desc: 'Open source vuln scanner.', color: '#9966ff', url: 'https://images.seeklogo.com/logo-png/29/1/snyk-logo-png_seeklogo-290110.png', img: null }
    ];

    // Updated malwareIcons array with only the two specified malware images
    const malwareIcons = [
      { name: 'Malware1', url: 'https://cdn.vectorstock.com/i/1000x1000/77/65/virus-infection-bug-icon-vector-12867765.webp', img: null },
      { name: 'Malware2', url: 'https://cdn3.iconfinder.com/data/icons/science-flat-round/512/bug_insect_ladybird_animal_virus_error_add-512.png', img: null }
    ];

    // Load the firewall icon image for the player sprite
    const playerImg = new Image();
    playerImg.src = 'firewall-icon.png'; // Local file, should be in the same directory

    const player = {
      x: width / 2 - 20, // Adjusted for 40px width
      y: height - 40,    // Adjusted for 40px height
      width: 40,
      height: 40,
      speed: 5,
      color: '#00ffcc'
    };

    let fallingSkills = [];
    let keys = {};

    let score = 0;
    let missed = 0;
    let gameOver = false;
    let gameOverMessage = ''; // Custom game over message

    // Game state flags
    let gameStarted = false; // True after countdown ends and game loop starts
    let countdown = 10; // Countdown seconds

    document.addEventListener('keydown', (e) => {
      if (gameStarted) {
        keys[e.key.toLowerCase()] = true;
      }
    });
    document.addEventListener('keyup', (e) => {
      if (gameStarted) {
        keys[e.key.toLowerCase()] = false;
      }
    });

    muteButton.addEventListener('click', () => {
      isMuted = !isMuted;
      muteButton.textContent = isMuted ? 'üîá Unmute' : 'üîà Mute';
    });

    function playSound(frequency = 440) {
      if (isMuted) return;
      const context = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = context.createOscillator();
      const gain = context.createGain();
      oscillator.type = 'square';
      oscillator.frequency.value = frequency;
      oscillator.connect(gain);
      gain.connect(context.destination);
      oscillator.start();
      oscillator.stop(context.currentTime + 0.1);
    }

    // Preload all skill and malware images to ensure smooth gameplay, including player image
    function preloadImages(callback) {
      let totalImages = skillIcons.length + malwareIcons.length + 1; // +1 for playerImg
      let loadedCount = 0;

      function checkAllLoaded() {
        loadedCount++;
        if (loadedCount === totalImages) {
          callback();
        }
      }

      for (let skill of skillIcons) {
        skill.img = new Image();
        skill.img.src = skill.url;
        skill.img.onload = checkAllLoaded;
        skill.img.onerror = () => { checkAllLoaded(); };
      }

      for (let malware of malwareIcons) {
        malware.img = new Image();
        malware.img.src = malware.url;
        malware.img.onload = checkAllLoaded;
        malware.img.onerror = () => { checkAllLoaded(); };
      }

      playerImg.onload = checkAllLoaded;
      playerImg.onerror = () => { checkAllLoaded(); };
    }

    // Spawn functions, game logic, draw functions, etc., remain unchanged but now use responsive width/height.

    // ... rest of game code remains as before ...
  </script>
</body>
</html>
